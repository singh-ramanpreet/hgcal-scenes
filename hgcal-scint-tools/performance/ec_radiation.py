#!/usr/bin/python3

#
# assumes 22 layers of CE-H
# units are mm
#
from math import pow

ec_radiation_dose_constants_v1=[
    8.3716475,	-0.0220786 ,	3.006084E-05, #extrapolated
    8.3566422,	-0.02298136,	3.358136E-05, #extrapolated
    8.3416369,	-0.02388412,	3.710188E-05, #extrapolated
    8.3266316,	-0.02478688,	4.06224E-05, #extrapolated
    8.3116263,	-0.02568964,	4.414292E-05, #extrapolated
    8.296621 ,   -0.0265924,	4.766344E-05, #extrapolated
    8.2816157,	-0.02749516,	5.118396E-05,    #extrapolated
    8.299604,   -0.0290919,     5.80655e-05, #extrapolated
    8.220779, 	-0.0286743, 	5.54E-05,
    8.237739, 	-0.0302172, 	6.16E-05,
    8.179820, 	-0.0301819, 	6.07E-05,
    8.245057, 	-0.0328519, 	7.30E-05,
    8.003339, 	-0.0301835, 	6.05E-05,
    8.153538, 	-0.0342127, 	7.67E-05,
    8.120029, 	-0.0354015, 	7.95E-05,
    8.226674, 	-0.0389842, 	9.12E-05,
    8.236943, 	-0.0404435, 	9.41E-05,
    8.349325, 	-0.0439407, 	0.000107185,
    8.361869, 	-0.0451275, 	0.000108543,
    8.366243, 	-0.0462844, 	0.000110395,
    8.547975, 	-0.0501267, 	0.000121752,
    8.562114, 	-0.050927 ,       0.000123288,
    8.626531, 	-0.0525138, 	0.000127741,
    8.547292, 	-0.0519252, 	0.000127745];

ec_radiation_dose_constants_v2=[
    1,4.402024,-0.0156828,4.48346e-05,-2.74299e-07,4.61552e-09,
    2,4.354541,-0.0158484,4.23988e-05,-2.09826e-07,7.26989e-09,
    3,4.295671,-0.0158796,4.00425e-05,-3.03675e-07,8.07429e-09,
    4,4.253903,-0.0159113,3.68236e-05,-3.08461e-07,8.42756e-09,
    5,4.174711,-0.0159658,4.06752e-05,-3.55346e-07,8.1756e-09,
    6,4.130049,-0.0161295,3.89136e-05,-3.51683e-07,8.06841e-09,
    7,4.087335,-0.0160449,5.84569e-05,-2.93202e-07,4.38376e-09,
    8,3.991499,-0.0159646,3.92842e-05,-5.48152e-07,8.4818e-09,
    9,3.985908,-0.0233164,0.000479769,-8.90993e-06,5.74269e-08,
    10,3.865145,-0.0157737,1.4102e-05,-2.59944e-08,5.18596e-09,
    11,3.797408,-0.0110597,-0.000150187,1.70552e-06,-9.14724e-10,
    12,3.851879,-0.00268387,-0.000502753,6.91762e-06,-2.62058e-08,
    13,3.637403,-0.0102584,-0.000280915,4.39397e-06,-1.67187e-08,
    14,3.502875,-0.00930028,-0.000349823,5.39975e-06,-2.10104e-08,
    15,3.408253,-0.00713129,-0.000358892,4.95141e-06,-1.79598e-08,
    16,3.308403,-0.010831,-0.000302115,4.5388e-06,-1.67407e-08,
    17,3.274672,-0.00658889,-0.000350272,4.3462e-06,-1.44797e-08,
    18,3.083276,-0.0102271,-0.00028511,3.5795e-06,-1.08933e-08,
    19,3.125504,-0.0073409,-0.000282136,3.16049e-06,-9.34773e-09,
    20,2.995494,-0.0193198,-6.97825e-06,6.81663e-07,-1.76918e-09,
    21,2.973583,-0.00764613,-0.000184954,1.73145e-06,-4.03636e-09,
    22,2.821734,-0.0158869,1.38538e-06,3.83847e-07,-1.34869e-09,
]

# copy of 3.7.16
ec_radiation_dose_constants_v3=[
    1,4.402024,-0.0156828,4.48346e-05,-2.74299e-07,4.61552e-09,
    2,4.354541,-0.0158484,4.23988e-05,-2.09826e-07,7.26989e-09,
    3,4.295671,-0.0158796,4.00425e-05,-3.03675e-07,8.07429e-09,
    4,4.253903,-0.0159113,3.68236e-05,-3.08461e-07,8.42756e-09,
    5,4.174711,-0.0159658,4.06752e-05,-3.55346e-07,8.1756e-09,
    6,4.130049,-0.0161295,3.89136e-05,-3.51683e-07,8.06841e-09,
    7,4.087335,-0.0160449,5.84569e-05,-2.93202e-07,4.38376e-09,
    8,3.991499,-0.0159646,3.92842e-05,-5.48152e-07,8.4818e-09,
    9,3.985908,-0.0233164,0.000479769,-8.90993e-06,5.74269e-08,
    10,3.865145,-0.0157737,1.4102e-05,-2.59944e-08,5.18596e-09,
    11,3.797408,-0.0110597,-0.000150187,1.70552e-06,-9.14724e-10,
    12,3.851879,-0.00268387,-0.000502753,6.91762e-06,-2.62058e-08,
    13,3.637403,-0.0102584,-0.000280915,4.39397e-06,-1.67187e-08,
    14,3.502875,-0.00930028,-0.000349823,5.39975e-06,-2.10104e-08,
    15,3.408253,-0.00713129,-0.000358892,4.95141e-06,-1.79598e-08,
    16,3.308403,-0.010831,-0.000302115,4.5388e-06,-1.67407e-08,
    17,3.274672,-0.00658889,-0.000350272,4.3462e-06,-1.44797e-08,
    18,3.083276,-0.0102271,-0.00028511,3.5795e-06,-1.08933e-08,
    19,3.125504,-0.0073409,-0.000282136,3.16049e-06,-9.34773e-09,
    20,2.995494,-0.0193198,-6.97825e-06,6.81663e-07,-1.76918e-09,
    21,2.973583,-0.00764613,-0.000184954,1.73145e-06,-4.03636e-09,
    22,2.821734,-0.0158869,1.38538e-06,3.83847e-07,-1.34869e-09,
]

# Radiation model
ec_radiation_fluence_constants_v1=[
    16.0226567,	-0.00741705,	-3.5516227E-05, # extrapolated!
    16.0213596,	-0.00856336,	-3.03862046E-05, # extrapolated!
    16.0200625,	-0.00970967,	-2.52561822E-05, # extrapolated!
    16.0187654,	-0.01085598,	-2.01261598E-05, # extrapolated!
    16.0174683,	-0.01200229,	-1.49961374E-05, # extrapolated!
    16.0161712,	-0.0131486 ,     -9.866115E-06, # extrapolated!
    16.0148741,	-0.01429491,	-4.7360926E-06, # extrapolated!
    16.012956,  -0.0154227,     1.64903e-7,
    16.012728, 	-0.0166023,	5.70057E-06,
    16.010278, 	-0.017721 ,      1.06677E-05,
    16.012235, 	-0.0189356,	1.61428E-05,
    16.006717, 	-0.0199876,	2.05939E-05,
    16.019074, 	-0.0231252,	3.39642E-05,
    16.054189, 	-0.0259338,	4.46E-05,
    16.072202, 	-0.0280338,	5.18275E-05,
    16.135712, 	-0.0306771,	6.08733E-05,
    16.189131, 	-0.032784 ,      6.64E-05,
    16.221881, 	-0.0344289,	7.04428E-05,
    16.287298, 	-0.036528 ,      7.58769E-05,
    16.323813, 	-0.0379123,	7.91142E-05,
    16.348277, 	-0.0387979,	7.92265E-05,
    16.372302, 	-0.0398136,	8.15301E-05,
    16.323458, 	-0.0396646,	8.14429E-05,
    16.081712, 	-0.0373117,	7.90704E-05
]

# 3.7.16
ec_radiation_fluence_constants_v2=[
    1,15.830771,0.0148882,-0.000518485,3.64098e-06,-8.86379e-09,
    2,15.870402,0.0116894,-0.000469637,3.30002e-06,-7.98202e-09,
    3,15.923279,0.00770814,-0.00040796,2.86073e-06,-6.83136e-09,
    4,15.948896,0.00518375,-0.000372932,2.63669e-06,-6.29536e-09,
    5,15.995978,0.00106243,-0.00030542,2.13914e-06,-4.98057e-09,
    6,16.022251,-0.00201605,-0.000255438,1.78582e-06,-4.11629e-09,
    7,16.148826,-0.0100131,-0.000122642,8.51172e-07,-1.83486e-09,
    8,16.207896,-0.0158729,-9.89334e-06,-4.44321e-08,5.81571e-10,
    9,16.460299,-0.0282926,0.000176,-1.24226e-06,3.33661e-09,
    10,16.074041,-0.0142934,-2.3325e-05,-9.91417e-08,1.05114e-09,
    11,15.856707,-0.00698478,-0.000129121,5.11442e-07,-1.75663e-10,
    12,15.514695,0.00534509,-0.000304267,1.51454e-06,-2.17969e-09,
    13,15.235543,0.0140316,-0.000430826,2.25819e-06,-3.69355e-09,
    14,15.364650,0.00885852,-0.000386321,2.09248e-06,-3.47966e-09,
    15,15.591748,0.00056066,-0.000302279,1.70913e-06,-2.84797e-09,
    16,15.353311,0.00786759,-0.000395923,2.15057e-06,-3.55091e-09,
    17,15.555453,0.00110278,-0.000332765,1.8694e-06,-3.08188e-09,
    18,15.822784,-0.00815451,-0.000231267,1.35734e-06,-2.15243e-09,
    19,15.909287,-0.0112805,-0.000205724,1.24919e-06,-1.99359e-09,
    20,16.115456,-0.0185292,-0.000131819,9.26615e-07,-1.49273e-09,
    21,16.356612,-0.0288606,-1.22903e-05,3.72635e-07,-6.06651e-10,
    22,16.758791,-0.0481384,0.000220859,-6.4673e-07,8.8165e-10
    ]

# 3.7.20
ec_radiation_fluence_constants_v3=[
    1,15.616705,-0.0127294,-0.000138386,2.35373e-06,-1.05516e-08,
    2,15.663588,-0.0122583,-0.000158514,2.66016e-06,-1.22522e-08,
    3,15.721775,-0.0122316,-0.000161723,2.66853e-06,-1.22476e-08,
    4,15.742044,-0.0117755,-0.00017655,2.84218e-06,-1.30183e-08,
    5,15.774878,-0.011661,-0.000184017,2.9552e-06,-1.36553e-08,
    6,15.783946,-0.011339,-0.000193429,3.0705e-06,-1.42094e-08,
    7,15.804632,-0.0112599,-0.000197699,3.1161e-06,-1.44138e-08,
    8,15.807931,-0.0109178,-0.000206652,3.20561e-06,-1.47333e-08,
    9,15.820948,-0.0106754,-0.000224291,3.5214e-06,-1.64548e-08,
    10,15.821811,-0.0105598,-0.000224938,3.49882e-06,-1.62712e-08,
    11,15.828709,-0.0105698,-0.000221073,3.39618e-06,-1.56742e-08,
    12,15.827745,-0.010498,-0.000220366,3.36032e-06,-1.54352e-08,
    13,15.832032,-0.0105607,-0.000218245,3.31101e-06,-1.51562e-08,
    14,15.829311,-0.010478,-0.000216471,3.24683e-06,-1.47529e-08,
    15,15.831208,-0.0103679,-0.000228907,3.4714e-06,-1.5931e-08,
    16,15.829479,-0.0103622,-0.000228943,3.46942e-06,-1.59022e-08,
    17,15.827972,-0.0104515,-0.000224706,3.36803e-06,-1.52614e-08,
    18,15.824651,-0.0104257,-0.000222065,3.29968e-06,-1.4853e-08,
    19,15.821972,-0.0105483,-0.000220894,3.295e-06,-1.48597e-08,
    20,15.818309,-0.0105909,-0.000215907,3.19777e-06,-1.43394e-08,
    21,15.814069,-0.0107143,-0.000212492,3.13926e-06,-1.40162e-08,
    22,15.811046,-0.0107957,-0.00020663,3.03967e-06,-1.35152e-08,
    23,15.805186,-0.0109025,-0.000203377,2.97651e-06,-1.31325e-08,
    24,15.801495,-0.0108678,-0.000202334,2.94639e-06,-1.29592e-08,
    25,15.794266,-0.0106717,-0.000215446,3.15586e-06,-1.39642e-08,
    26,15.791249,-0.010731,-0.000210487,3.06332e-06,-1.34609e-08,
    27,15.779913,-0.0103115,-0.000224409,3.21891e-06,-1.40207e-08,
    28,15.771804,-0.00978981,-0.000237701,3.34192e-06,-1.43964e-08,
    29,14.833335,-0.0147383,4.31275e-05,-1.3833e-07,-1.03804e-08,
    30,14.794270,-0.0148454,4.23238e-05,-1.24001e-07,-9.40728e-09,
    31,14.748989,-0.0150426,4.07092e-05,-1.03116e-07,-7.66714e-09,
    32,14.700761,-0.0152222,4.36172e-05,-7.34299e-08,-7.47496e-09,
    33,14.650917,-0.0154473,4.18512e-05,-2.43583e-08,-6.0834e-09,
    34,14.599221,-0.0157698,3.68604e-05,2.16031e-08,-3.67968e-09,
    35,14.550941,-0.0160171,2.77865e-05,5.38705e-08,-9.3933e-10,
    36,14.500462,-0.0161263,1.56916e-05,-7.43467e-08,3.19076e-09,
    37,14.449798,-0.0163742,3.80715e-06,-1.44521e-07,5.51532e-09,
    38,14.390932,-0.0170309,4.671e-06,-1.49849e-08,4.68519e-09,
    39,14.336963,-0.0175395,9.7057e-06,1.3759e-07,2.82877e-09,
    40,14.283066,-0.0182474,1.83221e-05,3.59623e-07,5.70474e-10,
    41,14.191588,-0.019546,2.8749e-05,7.54282e-07,-3.1025e-09,
    42,14.094139,-0.0204399,4.29032e-05,7.91886e-07,-3.945e-09,
    43,14.005578,-0.0216672,4.17266e-05,1.05378e-06,-5.40766e-09,
    44,13.929788,-0.0223923,4.82595e-05,1.00438e-06,-5.22229e-09,
    45,13.861681,-0.0232132,5.06856e-05,9.632e-07,-4.92617e-09,
    46,13.797075,-0.0239768,5.72912e-05,8.66886e-07,-4.48328e-09,
    47,13.736916,-0.024619,5.80826e-05,7.95171e-07,-3.97267e-09,
    48,13.687808,-0.0245528,6.38052e-05,6.19445e-07,-3.19333e-09,
    49,13.636401,-0.0235333,7.48035e-05,3.07652e-07,-1.88342e-09,
    50,13.591645,-0.0208741,7.81613e-05,-4.06877e-08,-3.84746e-10
    ]


radiation_model=3

def dose(layer,radius):
    global ec_radiation_dose_constants_v1, ec_radiation_dose_constants_v2, radiation_model
    if (layer<1 or layer>22): return 0
    if (radiation_model==1):
        index=(layer-(1))*3
        return pow(10,ec_radiation_dose_constants_v1[index]+radius/10*ec_radiation_dose_constants_v1[index+1]+radius*radius/100*ec_radiation_dose_constants_v1[index+2])
    else:
        index=(layer-(1))*6
        r=radius/10-100
        # plus 2 for Gy -> RAD
        return pow(10,(ec_radiation_dose_constants_v2[index+1]+2)+r*ec_radiation_dose_constants_v2[index+2]+r*r*ec_radiation_dose_constants_v2[index+3]+r*r*r*ec_radiation_dose_constants_v2[index+4]+r*r*r*r*ec_radiation_dose_constants_v2[index+5])

def fluence(layer,radius):
    global ec_radiation_fluence_constants_v1, ec_radiation_fluence_constants_v2, ec_radiation_fluence_constants_v3, radiation_model
    if (layer<1 or layer>22): return 0
    if (radiation_model==1):
        index=(layer-(28+1))*3
        return pow(10,ec_radiation_fluence_constants_v1[index]+radius/10*ec_radiation_fluence_constants_v1[index+1]+radius*radius/100*ec_radiation_fluence_constants_v1[index+2])
    elif (radiation_model==2):
        index=(layer-(1))*6
        r=radius/10
        return pow(10,ec_radiation_fluence_constants_v2[index+1]+r*ec_radiation_fluence_constants_v2[index+2]+r*r*ec_radiation_fluence_constants_v2[index+3]+r*r*r*ec_radiation_fluence_constants_v2[index+4]+r*r*r*r*ec_radiation_fluence_constants_v2[index+5])
    else: # (radiation_model==2):
        index=(layer-(1)+28)*6
        r=(radius/10-100.0)
        return pow(10,ec_radiation_fluence_constants_v3[index+1]+r*ec_radiation_fluence_constants_v3[index+2]+r*r*ec_radiation_fluence_constants_v3[index+3]+r*r*r*ec_radiation_fluence_constants_v3[index+4]+r*r*r*r*ec_radiation_fluence_constants_v3[index+5])        

    
